# CL_milestone_implement

This is Pytorch implementation of the Prompt-based Continual Learning with [pytorch-template](https://github.com/victoresque/pytorch-template) in the following milestone papers:

- [L2P] A Baseline for Detecting Missclassified and Out-of-Distribution Examples in Neural Networks | **[CVPR2022]** [[paper]](https://arxiv.org/abs/2112.08654.pdf)

## Installation & requirement

The current version of the code has been tested with `python 3.8.0` on an Ubuntu 18.04 OS with the following versions of Pytorch, Torchvision and timm:

- `pytorch 1.12.0`
- `torchvision 0.13.0`
- `timm 0.6.7`

Further Python-packages used are listed in `requirements.txt`.
Assuming Python and pip are set up, these packages can be installed using:
```bash
pip install -r requirements.txt
```

## Folder Structure
```angular2html
OOD_milestone_implement/
│
├── L2P/ - L2P implementation proj
│   └── data_loader/ - CIFAR100 and 5-dataset loader
│   └── model/ - backbone (ViT) + prompt src
│   └── output/ - checkpoint dir
│   └── trainer/ - Train core src
│   └── utils/ 
│   └── parse_config.py - parser
│   └── train.py - main src
├── ViT/ - ViT implementation proj
├── license
├── requirements.txt
└── train.py - **main script to start training**
```

## Running custom experiments
### 1. L2P
**How to run?**

(1) If you want to full-train
```train
CUDA_VISIBLE_DEVICES=[GPU idx] python -m torch.distributed.launch \
        --nproc_per_node=[Node num] \
        --use_env train.py \
        cifar100_l2p \
        --model vit_base_patch16_224 \
        --batch-size [Batch size] \
```
(2) If you want to evaluate OOD score
```eval
CUDA_VISIBLE_DEVICES=[GPU idx] python -m torch.distributed.launch --nproc_per_node=[Node num] --use_env train.py cifar100_l2p --eval
```

**Result**

(1) CIFAR100
```result
Loading checkpoint from: ./output/checkpoint/task1_checkpoint.pth
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:08<00:00,  7.84it/s]
Task ID : 0, Val loss : 0.096, ACC@1 : 98.000, ACC@5 : 100.000

Loading checkpoint from: ./output/checkpoint/task2_checkpoint.pth
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:05<00:00, 10.53it/s]
Task ID : 0, Val loss : 2.242, ACC@1 : 51.600, ACC@5 : 76.000
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.43it/s]
Task ID : 1, Val loss : 0.169, ACC@1 : 96.000, ACC@5 : 99.700

Loading checkpoint from: ./output/checkpoint/task3_checkpoint.pth
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.38it/s]
Task ID : 0, Val loss : 4.744, ACC@1 : 22.400, ACC@5 : 46.600
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.30it/s]
Task ID : 1, Val loss : 3.021, ACC@1 : 47.400, ACC@5 : 66.800
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.37it/s]
Task ID : 2, Val loss : 0.143, ACC@1 : 95.400, ACC@5 : 99.800

Loading checkpoint from: ./output/checkpoint/task4_checkpoint.pth
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.32it/s]
Task ID : 0, Val loss : 6.250, ACC@1 : 9.300, ACC@5 : 21.300
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.36it/s]
Task ID : 1, Val loss : 4.360, ACC@1 : 33.500, ACC@5 : 48.000
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.26it/s]
Task ID : 2, Val loss : 1.829, ACC@1 : 65.200, ACC@5 : 80.500
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.31it/s]
Task ID : 3, Val loss : 0.120, ACC@1 : 97.000, ACC@5 : 99.900

Loading checkpoint from: ./output/checkpoint/task5_checkpoint.pth
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.29it/s]
Task ID : 0, Val loss : 8.498, ACC@1 : 0.200, ACC@5 : 2.000
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.29it/s]
Task ID : 1, Val loss : 6.332, ACC@1 : 10.500, ACC@5 : 22.100
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.29it/s]
Task ID : 2, Val loss : 5.176, ACC@1 : 30.000, ACC@5 : 49.200
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.27it/s]
Task ID : 3, Val loss : 2.479, ACC@1 : 52.800, ACC@5 : 73.000
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.34it/s]
Task ID : 4, Val loss : 0.123, ACC@1 : 96.300, ACC@5 : 100.000

Loading checkpoint from: ./output/checkpoint/task6_checkpoint.pth
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.32it/s]
Task ID : 0, Val loss : 8.952, ACC@1 : 0.000, ACC@5 : 0.100
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.30it/s]
Task ID : 1, Val loss : 6.406, ACC@1 : 8.800, ACC@5 : 18.900
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.31it/s]
Task ID : 2, Val loss : 4.491, ACC@1 : 31.300, ACC@5 : 50.700
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.24it/s]
Task ID : 3, Val loss : 3.563, ACC@1 : 48.000, ACC@5 : 66.800
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.17it/s]
Task ID : 4, Val loss : 1.690, ACC@1 : 74.300, ACC@5 : 88.400
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.24it/s]
Task ID : 5, Val loss : 0.136, ACC@1 : 95.100, ACC@5 : 99.700

Loading checkpoint from: ./output/checkpoint/task7_checkpoint.pth
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.25it/s]
Task ID : 0, Val loss : 8.895, ACC@1 : 0.100, ACC@5 : 0.200
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.24it/s]
Task ID : 1, Val loss : 7.561, ACC@1 : 1.500, ACC@5 : 4.800
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.20it/s]
Task ID : 2, Val loss : 6.310, ACC@1 : 11.300, ACC@5 : 27.700
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.21it/s]
Task ID : 3, Val loss : 4.689, ACC@1 : 30.100, ACC@5 : 45.700
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.26it/s]
Task ID : 4, Val loss : 2.635, ACC@1 : 57.300, ACC@5 : 70.700
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.21it/s]
Task ID : 5, Val loss : 1.683, ACC@1 : 68.700, ACC@5 : 84.900
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.26it/s]
Task ID : 6, Val loss : 0.166, ACC@1 : 94.900, ACC@5 : 99.900

Loading checkpoint from: ./output/checkpoint/task8_checkpoint.pth
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.28it/s]
Task ID : 0, Val loss : 10.266, ACC@1 : 0.000, ACC@5 : 0.000
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.14it/s]
Task ID : 1, Val loss : 8.710, ACC@1 : 0.600, ACC@5 : 1.200
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.21it/s]
Task ID : 2, Val loss : 8.305, ACC@1 : 2.900, ACC@5 : 9.100
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.27it/s]
Task ID : 3, Val loss : 6.522, ACC@1 : 6.800, ACC@5 : 15.000
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.22it/s]
Task ID : 4, Val loss : 4.081, ACC@1 : 32.500, ACC@5 : 46.300
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.21it/s]
Task ID : 5, Val loss : 3.950, ACC@1 : 43.900, ACC@5 : 54.500
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.25it/s]
Task ID : 6, Val loss : 2.657, ACC@1 : 52.100, ACC@5 : 76.600
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.19it/s]
Task ID : 7, Val loss : 0.093, ACC@1 : 97.000, ACC@5 : 99.600

Loading checkpoint from: ./output/checkpoint/task9_checkpoint.pth
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.19it/s]
Task ID : 0, Val loss : 10.523, ACC@1 : 0.000, ACC@5 : 0.000
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.23it/s]
Task ID : 1, Val loss : 8.589, ACC@1 : 0.000, ACC@5 : 0.500
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.23it/s]
Task ID : 2, Val loss : 7.436, ACC@1 : 2.700, ACC@5 : 6.600
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.18it/s]
Task ID : 3, Val loss : 6.332, ACC@1 : 3.100, ACC@5 : 14.400
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.13it/s]
Task ID : 4, Val loss : 5.591, ACC@1 : 11.000, ACC@5 : 30.800
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.25it/s]
Task ID : 5, Val loss : 4.197, ACC@1 : 24.300, ACC@5 : 41.800
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.21it/s]
Task ID : 6, Val loss : 2.667, ACC@1 : 48.200, ACC@5 : 74.700
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.17it/s]
Task ID : 7, Val loss : 0.654, ACC@1 : 86.300, ACC@5 : 96.100
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.19it/s]
Task ID : 8, Val loss : 0.073, ACC@1 : 97.800, ACC@5 : 99.800

Loading checkpoint from: ./output/checkpoint/task10_checkpoint.pth
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.26it/s]
Task ID : 0, Val loss : 11.497, ACC@1 : 0.000, ACC@5 : 0.000
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.17it/s]
Task ID : 1, Val loss : 9.641, ACC@1 : 0.000, ACC@5 : 0.300
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.15it/s]
Task ID : 2, Val loss : 8.929, ACC@1 : 0.000, ACC@5 : 1.000
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.20it/s]
Task ID : 3, Val loss : 8.747, ACC@1 : 0.300, ACC@5 : 1.600
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.20it/s]
Task ID : 4, Val loss : 7.739, ACC@1 : 3.400, ACC@5 : 10.700
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.20it/s]
Task ID : 5, Val loss : 6.127, ACC@1 : 20.300, ACC@5 : 31.800
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.14it/s]
Task ID : 6, Val loss : 4.042, ACC@1 : 29.600, ACC@5 : 59.500
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.15it/s]
Task ID : 7, Val loss : 3.532, ACC@1 : 39.500, ACC@5 : 68.400
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.22it/s]
Task ID : 8, Val loss : 1.698, ACC@1 : 73.100, ACC@5 : 91.900
100%|█████████████████████████████████████████████████████████████████████████████████████████████████████████████████████████| 63/63 [00:06<00:00, 10.12it/s]
Task ID : 9, Val loss : 0.055, ACC@1 : 98.600, ACC@5 : 100.000
 ```


## License

This project is licensed under the MIT License. See [LICENSE](https://github.com/yunseokddi/CL_milestone_implement/blob/main/LICENSE) for more details

## Reference

- **Project structure**: [https://github.com/jfc43/informative-outlier-mining](https://github.com/jfc43/informative-outlier-mining)
- **L2P**
  - [Original code] [https://github.com/google-research/l2p](https://github.com/google-research/l2p)
    
  - [Pytorch version] [https://github.com/JH-LEE-KR/l2p-pytorch](https://github.com/JH-LEE-KR/l2p-pytorch) 